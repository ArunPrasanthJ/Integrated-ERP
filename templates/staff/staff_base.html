<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>College ERP Staff Portal</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    /* copied from a_dash.html to match admin styling */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    body {
      background: #f4f6fb;
      display: flex;
    }

    /* Sidebar */
    .sidebar {
      width: 220px;
      background: #fff;
      height: 100vh;
      box-shadow: 2px 0 10px rgba(0,0,0,0.1);
      padding: 20px 0;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }
    .container {
      display: flex;
      gap: 20px; /* spacing between blocks */
      justify-content: center;
      margin-top: 20px;
      background: #fff;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.07);
    }
  

    .sidebar h2 {
      text-align: center;
      margin-bottom: 30px;
      color: #4e4376;
    }

    .sidebar ul {
      list-style: none;
    }

    .sidebar ul li {
      padding: 15px 20px;
      color: #333;
      cursor: pointer;
      transition: background 0.3s;
    }
    .sidebar ul li a {
      text-decoration: none;
      color: inherit;
      display: block;
      width: 100%;
    }

    .sidebar ul li:hover, .sidebar ul li.active {
      background: #4e4376;
      color: #fff;
      border-radius: 8px;
    }

    .sidebar .bottom {
      padding: 15px 20px;
      font-size: 14px;
      color: #888;
      cursor: pointer;
    }

    /* Main content */
    .main {
      flex: 1;
      padding: 20px;
      overflow-y: auto;
    }

    .topbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .topbar h3 {
      color: #4e4376;
    }
    /* Style the select box */
    select {
      width: 100%;                 /* Full width inside the form */
      padding: 10px;               /* Space inside */
      border: 1px solid #ccc;      /* Light border */
      border-radius: 8px;          /* Rounded corners */
      background-color: #fff;      /* Background */
      font-size: 16px;             /* Font size */
      color: #333;                 /* Text color */
      appearance: none;            /* Remove default arrow */
      -webkit-appearance: none;
      -moz-appearance: none;
      cursor: pointer;
      box-shadow: 0 2px 6px rgba(0,0,0,0.05); /* Soft shadow */
    }

    /* Style dropdown options */
    select option {
      padding: 10px;
      font-size: 15px;
      background: #fff;
      color: #333;
    }

    /* On hover for options */
    select option:hover {
      background: #f0f0f0;
    }

    /* Add custom dropdown arrow */
    select {
      background-image: url("data:image/svg+xml;utf8,<svg fill='%23666' height='24' viewBox='0 0 24 24' width='24' xmlns='http://www.w3.org/2000/svg'><path d='M7 10l5 5 5-5z'/></svg>");
      background-repeat: no-repeat;
      background-position: right 10px center;
      background-size: 20px;
    }

    .profile {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .profile img {
      width: 35px;
      height: 35px;
      border-radius: 50%;
    }

    .card {
      background: #fff;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.07);
      margin-bottom: 20px;
    }
    .quick-stats {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 20px;
      margin-bottom: 20px;
    }
    .stat-box {
      background: #fff;
      border-radius: 12px;
      padding: 20px;
      text-align: center;
      font-weight: bold;
      box-shadow: 0 4px 10px rgba(0,0,0,0.05);
    }

    .welcome {
      background: linear-gradient(135deg, #6a11cb, #2575fc);
      color: #fff;
      padding: 30px;
      border-radius: 12px;
      margin-bottom: 20px;
    }

    .welcome h2 {
      margin-bottom: 10px;
    }

    /* Chart + Messages side by side */
    .center-section {
      display: flex;
      justify-content: center;
      align-items: flex-start;
      gap: 40px;
      margin-top: 20px;
      flex-wrap: wrap; /* stack on small screens */
    }

    /* Messages section */
    .messages-section {
      width: 500px;
      max-width: 100%;
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    /* Chat box */
    .chat-box {
      border: 1px solid #ccc;
      padding: 15px;
      height: 200px;
      overflow-y: auto;
      border-radius: 8px;
      background: #fff;
      box-shadow: 0 2px 6px rgba(0,0,0,0.05);
    }

    /* Message form */
    .message-form {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .message-form textarea, 
    .message-form button, 
    .messages-section select {
      padding: 10px 12px;
      border-radius: 6px;
      font-size: 14px;
    }
    .sticky-div {
      position: sticky;
      bottom: 0; /* or top: 0 to stick at top */
      padding: 5px;
    }
    .message-form textarea, 
    .messages-section select {
      border: 1px solid #ccc;
    }

    .message-form textarea {
      resize: vertical;
    }

    .message-form button {
      background: #4e4376;
      color: #fff;
      border: none;
      cursor: pointer;
      font-weight: bold;
      transition: background 0.3s;
    }

    .message-form button:hover {
      background: #372d5f;
    }
    /* flash messages */
    .flash-container {
      margin: 10px 0;
      padding: 0 20px;
    }
    .flash {
      padding: 10px 15px;
      border-radius: 4px;
      margin-bottom: 5px;
    }
    .flash.success { background-color: #d4edda; color: #155724; }
    .flash.danger { background-color: #f8d7da; color: #721c24; }
    .flash.warning { background-color: #fff3cd; color: #856404; }
    .flash.info { background-color: #d1ecf1; color: #0c5460; }

    /* Form Styling */
    form {
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.06);
      margin-bottom: 20px;
    }

    form h3 {
      color: #4e4376;
      margin-bottom: 15px;
      font-size: 18px;
    }

    label {
      display: block;
      margin: 12px 0 6px 0;
      color: #333;
      font-weight: 500;
      font-size: 14px;
    }

    input[type="text"],
    input[type="date"],
    input[type="number"],
    input[type="email"],
    input[type="password"],
    select,
    textarea {
      width: 100%;
      padding: 10px 12px;
      margin-bottom: 12px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 14px;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      transition: border-color 0.3s, box-shadow 0.3s;
    }

    input[type="text"]:focus,
    input[type="date"]:focus,
    input[type="number"]:focus,
    input[type="email"]:focus,
    input[type="password"]:focus,
    select:focus,
    textarea:focus {
      outline: none;
      border-color: #4e4376;
      box-shadow: 0 0 0 3px rgba(78, 67, 118, 0.1);
    }

    textarea {
      resize: vertical;
      min-height: 80px;
    }

    /* Button Styling */
    button,
    input[type="submit"],
    input[type="button"] {
      background: #4e4376;
      color: #fff;
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.3s, transform 0.1s;
      margin-top: 5px;
    }

    button:hover,
    input[type="submit"]:hover,
    input[type="button"]:hover {
      background: #372d5f;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(78, 67, 118, 0.3);
    }

    button:active,
    input[type="submit"]:active,
    input[type="button"]:active {
      transform: translateY(0);
    }

    /* Table Styling */
    .data-table {
      width: 100%;
      border-collapse: collapse;
      background: #fff;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 2px 8px rgba(0,0,0,0.06);
    }

    .data-table th {
      background-color: #4e4376;
      color: #fff;
      padding: 12px 15px;
      text-align: left;
      font-weight: 600;
      font-size: 14px;
    }

    .data-table td {
      padding: 12px 15px;
      border-bottom: 1px solid #eee;
      font-size: 14px;
    }

    .data-table tr:hover {
      background-color: #f9fafc;
    }

    .data-table tr:last-child td {
      border-bottom: none;
    }

    /* Status badges */
    .status {
      display: inline-block;
      padding: 5px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
    }

    .status-present {
      background-color: #e8f5e9;
      color: #2e7d32;
    }

    .status-absent {
      background-color: #ffebee;
      color: #c62828;
    }

    .status-leave {
      background-color: #fff3e0;
      color: #e65100;
    }
  </style>
</head>
<body>
  <!-- Sidebar -->
  <div class="sidebar">
    <div>
      <h2>College ERP</h2>
      <ul>
        <li{% if active=='dashboard' %} class="active"{% endif %}><a href="{{ url_for('staff_bp.staff_main_dashboard') }}">Dashboard</a></li>
        <li{% if active=='attendance' %} class="active"{% endif %}><a href="{{ url_for('staff_bp.staff_attendance') }}">Attendance</a></li>
        <li{% if active=='att_entry' %} class="active"{% endif %}><a href="{{ url_for('staff_entries.attendance_entry') }}">Attendance Entry</a></li>
        <li{% if active=='results' %} class="active"{% endif %}><a href="{{ url_for('staff_bp.staff_results') }}">Results</a></li>
        <li{% if active=='marks_entry' %} class="active"{% endif %}><a href="{{ url_for('staff_entries.marks_entry') }}">Marks Entry</a></li>
      </ul>
    </div>
    <div class="sticky-div">
      <div class="bottom">
        âš™ Settings
        <div id="logout" style="display:none; margin-top:10px; cursor:pointer; color:#4e4376;" onclick="logout()">
          ðŸ”’ Logout
        </div>
      </div>
    </div>
  </div>

  <!-- Main content -->
  <div class="main">
    <!-- Topbar -->
    <div class="topbar">
      <h3>Staff Dashboard</h3>
      <div class="profile">
        <span>Welcome, {{ session.username }}</span>
        <img src="/static/log.jpg" alt="Logo Placeholder" />
      </div>
    </div>

    <!-- Welcome -->
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <div class="flash-container">
          {% for category, message in messages %}
            <div class="flash {{ category }}">{{ message }}</div>
          {% endfor %}
        </div>
      {% endif %}
    {% endwith %}

    <div class="welcome">
      <h2>Welcome Back, {{session['username']}}</h2>
    </div>

    <!-- Dashboard-only content (chart & messages) -->
    {% if active == 'dashboard' %}
      <div class="quick-stats">
        <div class="stat-box">ðŸŽ“ Total Students: {{count}}</div>
        <div class="stat-box">ðŸ’° Paid Students: {{c}}</div>
        <div class="stat-box">ðŸ’µ Unpaid: {{count - c}}</div>
        <div class="stat-box">ðŸ“ˆ Overview</div>
      </div>

      <!-- Centered Section with Chart and Messages -->
      <div class="center-section">
        <!-- Chart Section (Left) -->
        <div class="card">
          <h3 style="text-align:center;">Payment Status Overview</h3>
          <canvas id="paymentChart"></canvas>
        </div>
        <!-- Messages Section (Right) -->
        <div class="messages-section">
        <div>
          <h2 style="text-align:center;">Messages</h2>
          <form method="POST">
            <label>Select Student:</label>
            <select name="student_username" onchange="this.form.submit()">
              <option value="">Choose</option>
              {% for student in student_c %}
                <option value="{{ student['username'] }}"
                  {% if student_username == student['username'] %} selected {% endif %}>
                  {{ student['username'] }}
                </option>
              {% endfor %}
            </select>
          </form>
        </div>

        {% if student_username %}
          <div class="chat-box">
            {% for msg in messages %}
              <p><b>{{ msg.sender }}:</b> {{ msg.message }} <small>[{{ msg.created_at }}]</small></p>
            {% endfor %}
          </div>

          <form method="POST" class="message-form">
            <input type="hidden" name="student_username" value="{{ student_username }}">
            <textarea name="message" placeholder="Type your message..." required></textarea>
            <button type="submit">Send</button>
          </form>
        {% endif %}
      </div>
      </div>
    {% endif %}

    <!-- Content block for child pages (attendance, marks, results, etc.) -->
    {% block content %}{% endblock %}

  <!-- Scripts -->
<script>
    const settings = document.querySelector('.sidebar .bottom');
    const logoutBtn = document.getElementById('logout');

    settings.addEventListener('click', () => {
      logoutBtn.style.display = logoutBtn.style.display === 'block' ? 'none' : 'block';
    });

    // Chart only initialized on dashboard
    const chartElement = document.getElementById('paymentChart');
    if (chartElement) {
      const ctx1 = chartElement.getContext('2d');
      new Chart(ctx1, {
        type: 'doughnut',
        data: {
          labels: ['Paid Students', 'Unpaid Students'],
          datasets: [{
            data: ["{{c}}", "{{count-c}}"],
            backgroundColor: ['#4caf50', '#f44336']
          }]
        }
      });
    }

function logout(){
      window.location.href="{{url_for('logout')}}";
}

</script>
</body>
</html>