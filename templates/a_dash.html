<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>College ERP Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    body {
      background: #f4f6fb;
      display: flex;
    }

    /* Sidebar */
    .sidebar {
      width: 220px;
      background: #fff;
      height: 130vh;
      box-shadow: 2px 0 10px rgba(0,0,0,0.1);
      padding: 20px 0;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }
    .container {
      display: flex;
      gap: 20px; /* spacing between blocks */
      justify-content: center;
      margin-top: 20px;
      background: #fff;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.07);
    }
  

    .sidebar h2 {
      text-align: center;
      margin-bottom: 30px;
      color: #4e4376;
    }

    .sidebar ul {
      list-style: none;
    }

    .sidebar ul li {
      padding: 15px 20px;
      color: #333;
      cursor: pointer;
      transition: background 0.3s;
    }

    .sidebar ul li:hover, .sidebar ul li.active {
      background: #4e4376;
      color: #fff;
      border-radius: 8px;
    }

    .sidebar .bottom {
      padding: 15px 20px;
      font-size: 14px;
      color: #888;
      cursor: pointer;
    }

    /* Main content */
    .main {
      flex: 1;
      padding: 20px;
      overflow-y: auto;
    }

    .topbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .topbar h3 {
      color: #4e4376;
    }
    /* Style the select box */
    select {
      width: 100%;                 /* Full width inside the form */
      padding: 10px;               /* Space inside */
      border: 1px solid #ccc;      /* Light border */
      border-radius: 8px;          /* Rounded corners */
      background-color: #fff;      /* Background */
      font-size: 16px;             /* Font size */
      color: #333;                 /* Text color */
      appearance: none;            /* Remove default arrow */
      -webkit-appearance: none;
      -moz-appearance: none;
      cursor: pointer;
      box-shadow: 0 2px 6px rgba(0,0,0,0.05); /* Soft shadow */
    }

    /* Style dropdown options */
    select option {
      padding: 10px;
      font-size: 15px;
      background: #fff;
      color: #333;
    }

    /* On hover for options */
    select option:hover {
      background: #f0f0f0;
    }

    /* Add custom dropdown arrow */
    select {
      background-image: url("data:image/svg+xml;utf8,<svg fill='%23666' height='24' viewBox='0 0 24 24' width='24' xmlns='http://www.w3.org/2000/svg'><path d='M7 10l5 5 5-5z'/></svg>");
      background-repeat: no-repeat;
      background-position: right 10px center;
      background-size: 20px;
    }

    .profile {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .profile img {
      width: 35px;
      height: 35px;
      border-radius: 50%;
    }

    .card {
      background: #fff;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.07);
      margin-bottom: 20px;
    }
    .quick-stats {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 20px;
      margin-bottom: 20px;
    }
    .stat-box {
      background: #fff;
      border-radius: 12px;
      padding: 20px;
      text-align: center;
      font-weight: bold;
      box-shadow: 0 4px 10px rgba(0,0,0,0.05);
    }

    .welcome {
      background: linear-gradient(135deg, #6a11cb, #2575fc);
      color: #fff;
      padding: 30px;
      border-radius: 12px;
      margin-bottom: 20px;
    }

    .welcome h2 {
      margin-bottom: 10px;
    }

    /* Chart + Messages side by side */
    .center-section {
      display: flex;
      justify-content: center;
      align-items: flex-start;
      gap: 40px;
      margin-top: 20px;
      flex-wrap: wrap; /* stack on small screens */
    }

    /* Chart card size */
    .center-section {
      display: flex;
      justify-content: center;
      align-items: flex-start;
      gap: 40px;
      margin-top: 20px;
      flex-wrap: wrap; /* responsive stack on small screens */
    }


    /* Messages section */
    .messages-section {
      width: 500px;
      max-width: 100%;
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    /* Chat box */
    .chat-box {
      border: 1px solid #ccc;
      padding: 15px;
      height: 200px;
      overflow-y: auto;
      border-radius: 8px;
      background: #fff;
      box-shadow: 0 2px 6px rgba(0,0,0,0.05);
    }

    /* Message form */
    .message-form {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .message-form textarea, 
    .message-form button, 
    .messages-section select {
      padding: 10px 12px;
      border-radius: 6px;
      font-size: 14px;
    }
    .sticky-div {
      position: sticky;
      bottom: 0; /* or top: 0 to stick at top */
      padding: 5px;
    }
    .message-form textarea, 
    .messages-section select {
      border: 1px solid #ccc;
    }

    .message-form textarea {
      resize: vertical;
    }

    .message-form button {
      background: #4e4376;
      color: #fff;
      border: none;
      cursor: pointer;
      font-weight: bold;
      transition: background 0.3s;
    }

    .message-form button:hover {
      background: #372d5f;
    }
  </style>
</head>
<body>
  <!-- Sidebar -->
  <div class="sidebar">
    <div>
      <h2>College ERP</h2>
      <ul>
        <li class="active">Dashboard</li>
        <li onclick="gotoaddusers()">Add users</li>
        <li onclick="gotostudpay()">Students payment</li>
        <li onclick="gotosheets()">Admission sheets</li>
        <li onclick="gototable()">Form tables</li>
      </ul>
    </div>
  <div class="sticky-div">
    <div class="bottom">
      ‚öô Settings

      <div id="logout" style="display:none; margin-top:10px; cursor:pointer; color:#4e4376;" onclick="logout()">
        üîí Logout
      </div>
    </div>
  </div>
  </div>

  <!-- Main content -->
  <div class="main">
    <!-- Topbar -->
    <div class="topbar">
      <h3>Dashboard</h3>
      <div class="profile">
        <span>Welcome, {{ session.username }}</span>
        <img src="/static/log.jpg" alt="Logo Placeholder" />
      </div>
    </div>

    <!-- Welcome -->
    <div class="welcome">
      <h2>Welcome Back, {{session['username']}}</h2>
    </div>
    <div class="quick-stats">
      <div class="stat-box">üéì Total Students:{{count}}</div>
      <div class="stat-box">üìù Fees deadline: 23 Sept</div>
      <div class="stat-box">üìö Forms issued: {{sheet_count}}</div>
      <div class="stat-box">üè† Hostel student: {{c}}</div>
    </div>

    <div id="attFormContainer" style="display:none; margin:20px;">
      <form id="attForm" method="POST" action="{{ url_for('ad_d.add_attendance') }}">
        <h3>Add Attendance</h3>
        <label>Username:</label>
        <input type="text" name="username" required>
        <label>Date:</label>
        <input type="date" name="date" required>
        <label>Status:</label>
        <select name="status">
          <option value="Present">Present</option>
          <option value="Absent">Absent</option>
          <option value="Leave">Leave</option>
        </select>
        <button type="submit">Submit</button>
      </form>
    </div>

    <div id="markFormContainer" style="display:none; margin:20px;">
      <form id="markForm" method="POST" action="{{ url_for('ad_d.add_marks') }}">
        <h3>Add Mark</h3>
        <label>Username:</label>
        <input type="text" name="username" required>
        <label>Mark:</label>
        <input type="number" name="mark" required>
        <button type="submit">Submit</button>
      </form>
    </div>

    <!-- Centered Section -->
  <div class="container center-section">
    <!-- Chart Section (Left) -->
    <div class="card">
      <h3 style="text-align:center;">Fees defaulters</h3>
      <canvas id="attendanceChart"></canvas>
    </div>
    <div class="container">
    <!-- Messages Section (Right) -->
    <div class="messages-section">
      <div>
        <h2 style="text-align:center;">Messages</h2>
        <form method="POST">
          <label>Select Student:</label>
          <select name="student_username" onchange="this.form.submit()">
            <option value="">Choose</option>
            {% for student in student_c %}
              <option value="{{ student['username'] }}"
                {% if student_username == student['username'] %} selected {% endif %}>
                {{ student['username'] }}
              </option>
            {% endfor %}
          </select>
        </form>
      </div>

      {% if student_username %}
        <div class="chat-box">
          {% for msg in messages %}
            <p><b>{{ msg.sender }}:</b> {{ msg.message }} <small>[{{ msg.created_at }}]</small></p>
          {% endfor %}
        </div>

        <form method="POST" class="message-form">
          <input type="hidden" name="student_username" value="{{ student_username }}">
          <textarea name="message" placeholder="Type your message..." required></textarea>
          <button type="submit">Send</button>
        </form>
      {% endif %}
    </div>
  </div>
  </div>

  <!-- Scripts -->
<script>
    const settings = document.querySelector('.sidebar .bottom');
    const logoutBtn = document.getElementById('logout');

    settings.addEventListener('click', () => {
      logoutBtn.style.display = logoutBtn.style.display === 'block' ? 'none' : 'block';
    });


    // Charts
    const ctx1 = document.getElementById('attendanceChart').getContext('2d');
    new Chart(ctx1, {
      type: 'doughnut',
      data: {
        labels: ['Paid students', 'Unpaid Students'],
        datasets: [{
          data: ["{{c}}", "{{count-c}}"],
          backgroundColor: ['#4caf50', '#f44336']
        }]
      }
    });
function logout(){
      window.location.href="{{url_for('logout')}}";
}
function gotodash(){
      window.location.href="{{url_for('ad_d.admin_dashboard')}}";
}
function gotoaddusers(){
      window.location.href="{{url_for('ad_u.manage_users')}}";
}
function gotostudpay(){
      window.location.href="{{url_for('ad_p.payment_details')}}";
}
function gotosheets(){
      window.location.href="{{url_for('ad_s.sheet_index')}}";
}
function gototable(){
      window.location.href="{{url_for('ad_t.table')}}";
}

</script>
</body>
</html>
